async function initPostHelper(){const p="encrypt";KEEP.utils.postHelper={postPageContainerDom:document.querySelector(".post-page-container"),toggleShowTocBtn:document.querySelector(".toggle-show-toc"),toggleShowTocTabletBtn:document.querySelector(".toggle-show-toc-tablet"),mainContentDom:document.querySelector(".main-content"),postToolsDom:document.querySelector(".post-tools"),isShowToc:!1,initToggleToc(){this.toggleShowTocBtn&&this.toggleShowTocBtn.addEventListener("click",()=>{this.postPageContainerDom.classList.contains(p)||(this.isShowToc=!this.isShowToc,KEEP.themeInfo.styleStatus.isShowToc=this.isShowToc,KEEP.setStyleStatus(),this.handleToggleToc(this.isShowToc))}),this.toggleShowTocTabletBtn&&this.toggleShowTocTabletBtn.addEventListener("click",()=>{if(!this.postPageContainerDom.classList.contains(p)){const e=document.querySelector(".tablet-post-toc-mask"),t=e.querySelector(".tablet-post-toc");document.body.style.overflow="hidden",e.style.background="rgba(0, 0, 0, 0.25)",e.style.visibility="visible",t.style.transform="translateX(0)",e.addEventListener("click",()=>{document.body.style.overflow="",e.style.background="rgba(0, 0, 0, 0)",e.style.visibility="hidden",t.style.transform="translateX(-100%)"})}})},handleToggleToc(e){e?(this.postPageContainerDom.classList.add("show-toc"),document.body.classList.add("has-toc")):(this.postPageContainerDom.classList.remove("show-toc"),document.body.classList.remove("has-toc")),setTimeout(()=>{this.setPostToolsLayout()},100)},hasToc(e){this.toggleShowTocBtn&&(this.toggleShowTocBtn.style.display="flex",this.isShowToc=e,this.handleToggleToc(e))},setPostToolsLayout(e){e=e||this.mainContentDom.getBoundingClientRect().width.toFixed(0);let t=5;window.innerWidth<=800&&(t=3);var o="left"===KEEP.theme_config.toc?.layout?"right":"left";this.postToolsDom.style.opacity="1",this.postToolsDom.style[o]=`calc((100vw - ${e}px) / 2 - ${t}rem)`},initSetPostToolsLeft(){setTimeout(()=>{this.setPostToolsLayout()},150),window.addEventListener("resize",()=>{this.setPostToolsLayout()})},goToComments(){const t=document.querySelector("#comments-anchor");[document.querySelector(".post-tools .go-to-comments"),document.querySelector(".exposed-tools-list .go-to-comments-tablet")].forEach(e=>{KEEP.utils.title2Top4HTag(e,t,300)})},watchPostCommentsCount(){const t=this.postToolsDom.querySelector(".post-comments-count");if(!t)return;const o=new MutationObserver(function(e){e.forEach(e=>{"childList"===e.type&&0<(e=Number(e.target.innerHTML))&&(t.style.display="flex",99<e)&&(t.innerHTML="99+",o.disconnect())})});o.observe(t,{attributes:!0,childList:!0})},setArticleAgingDays(){var e,t,o,s,n=document.querySelector(".post-content .post-aging-tips");n&&(e=n.querySelector(".days"),o=Date.now(),t=864e5*(n.dataset?.agingDays||30),s=((o=o-new Date(n.dataset.updateDate).getTime())/864e5).toFixed(0),t<=o)&&(e.innerHTML=s,n.style.display="block")},resetPostUpdateDate(){var e=document.querySelector(".post-meta-info-container .post-update-date .datetime"),t=new Date(e.dataset.updated).getTime(),o=KEEP.theme_config.post?.datetime_format||KEEP.themeInfo.defaultDatetimeFormat;e.innerHTML=KEEP.utils.formatDatetime(o,t)},enableFullScreen(){var e=document.querySelector(".post-tools-container .full-screen");if(e){const o=e.querySelector("i"),s=()=>document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;var t=()=>{s()?(o.classList.remove("fa-expand"),o.classList.add("fa-compress")):(o.classList.remove("fa-compress"),o.classList.add("fa-expand"))};e.addEventListener("click",function(){s()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen()}),document.addEventListener("fullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("webkitfullscreenchange",t)}},hexToBuffer(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map(e=>parseInt(e,16))).buffer},async decrypt(e,t){var o={name:"AES-CBC",iv:this.hexToBuffer(e.iv)},t=await crypto.subtle.importKey("raw",this.hexToBuffer(t),o,!1,["decrypt"]),o=await crypto.subtle.decrypt(o,t,this.hexToBuffer(e.encryptedData));return(new TextDecoder).decode(o)},encryptTocHandle(t){setTimeout(()=>{var e=document.querySelector(".pc-post-toc");e&&(this.handleToggleToc(t),t?e?.removeAttribute("style"):e.style.display="none")})},async postEncryptHandle(){const n=document.querySelector(".post-content"),i=n.querySelector(".post-encrypt-box"),c=document.querySelector(".post-tools-list .post-lock"),e=KEEP.themeInfo.encryptKey+"#"+location.pathname,a="decrypt";if(i){this.encryptTocHandle(!1);const{secret:l,ep:r,content:d,iv:u}=i.dataset,m=(i.removeAttribute("data-secret"),i.removeAttribute("data-iv"),i.removeAttribute("data-ep"),i.removeAttribute("data-content"),i.querySelector(".password-input")),t=async(e=!1)=>{var t=m.value,o=await this.decrypt({iv:u,encryptedData:r},l),s=async()=>{var e=await this.decrypt({iv:u,encryptedData:d},l);i.style.display="none",n.removeChild(i),this.postPageContainerDom.classList.remove(p),this.encryptTocHandle(!0),n.querySelector(".post").innerHTML=e,setTimeout(()=>{KEEP.initLazyLoad(),KEEP.initCodeBlock(),KEEP.initTOC(),KEEP.utils.zoomInImage(),KEEP.utils.insertTooltipContent(),KEEP.utils.tabsActiveHandle(),KEEP.utils.wrapTableWithBox(),KEEP.utils.aAnchorJump()}),c.classList.add(a),c.classList.add("tooltip"),sessionStorage.setItem(KEEP.themeInfo.encryptKey+"#"+location.pathname,"1")};e||t===o?await s():m.classList.add("error")};sessionStorage.getItem(e)&&await t(!0),m.addEventListener("keydown",async e=>{""===m.value&&m.classList.remove("error"),13===e.keyCode&&(await t(),e.preventDefault())}),m.addEventListener("keyup",async e=>{""===m.value&&m.classList.remove("error")}),c.addEventListener("click",()=>{c.classList.contains(a)&&(c.classList.remove(a),sessionStorage.removeItem(e),location.reload())})}}},KEEP.utils.postHelper.initSetPostToolsLeft(),KEEP.utils.postHelper.setArticleAgingDays(),KEEP.utils.postHelper.resetPostUpdateDate(),KEEP.utils.postHelper.enableFullScreen(),KEEP.utils.postHelper.postPageContainerDom.classList.contains(p)&&await KEEP.utils.postHelper.postEncryptHandle(),!0===KEEP.theme_config.toc?.enable&&KEEP.utils.postHelper.initToggleToc(),!0===KEEP.theme_config.comment?.enable&&(KEEP.utils.postHelper.goToComments(),KEEP.utils.postHelper.watchPostCommentsCount())}!0===KEEP.theme_config.pjax?.enable&&KEEP.utils?initPostHelper():window.addEventListener("DOMContentLoaded",initPostHelper);